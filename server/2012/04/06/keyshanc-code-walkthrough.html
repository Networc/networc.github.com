<html>
<head>
   <meta http-equiv="content-type" content="text/html; charset=utf-8" />
   
   
   <title>Keyshanc Code Walkthrough - Andrew C. Reed</title>
   

   <meta name="author" content="Andrew C. Reed" />
   
   <meta name="description" content="A walkthrough of the KEYboard SHA-based eNCrypter algorithm." />
   

   
   <meta name="keywords" content="keyshanc, keyboard encrypter, keyboard encryption" />
   

   <!-- syntax highlighting CSS -->
   <link rel="stylesheet" href="/css/syntax.css" type="text/css" />

   <!-- Homepage CSS -->
   <link rel="stylesheet" href="/css/screen.css" type="text/css" media="screen, projection" />

   <!-- Google Analytics Code -->
   <script type="text/javascript">

     var _gaq = _gaq || [];
     _gaq.push(['_setAccount', 'UA-30196325-1']);
     _gaq.push(['_trackPageview']);

     (function() {
       var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
       ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
       var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
     })();

   </script>
   <!-- End Google Analytics Code -->

   <!-- Javascript needed by projects.html -->
   <script src="/javascripts/jquery.js" type="text/javascript" charset="utf-8"></script>
   <script type="text/javascript" src="/javascripts/jquery.github.js"></script>

</head>
<body>
<div class="site">
  <div class="title">
    <a href="/">Andrew C. Reed</a>
    <a class="extra" href="/">home</a>
    <a class="extra" href="/about.html">about</a>
    <a class="extra" href="/blog.html">blog</a>
    <a class="extra" href="/projects.html">projects</a>
  </div>

  <h1>Keyshanc Code Walkthrough</h1>
<p class="meta">06 Apr 2012</p>
<div class="social">
  <div class="share">
    <div class="g-plusone" data-size="medium"></div>
  </div>
  <div class="share">
    <iframe allowtransparency="true" frameborder="0" scrolling="no" src="http://platform.twitter.com/widgets/tweet_button.html?url=http://andrewcreed.com/2012/04/06/keyshanc-code-walkthrough.html&text=Keyshanc Code Walkthrough&hashtags=keyshanc&via=ac_reed&count=horizontal" style="width:115px; height:21px;"></iframe>
  </div>
</div>
<br />
<div id="post">
<p><a href="https://github.com/Networc/keyshanc">Keyshanc Source Code</a></p>

<h3>Input Parameters</h3>

<p>The two input parameters to the Keyshanc function are:
* An array of 95 characters (which does not need to be initialized)
* A string which serves as a "password"</p>

<h3>Step 1: SHA512 &amp; SHA256 Hash</h3>

<p>The first step of the algorithm is to compute both the SHA512 and the SHA256 hash of the password.</p>

<pre><code>std::string i = SHA512(password);
std::string j = SHA256(password);
</code></pre>

<h3>Step 2: Initialize/Reset the Array</h3>

<p>The array of ASCII characters must be reset in order to ensure that the same substitution cipher is always produced for a given password. This step also serves to initialize the values of the array if the calling program has not already done so.</p>

<pre><code>for (int x=0; x &lt; 95 ; ++x)
{
    keys[x] = char(x+32);
}
</code></pre>

<p>The end result of this FOR loop is that keys[] now contains the ASCII characters 'Space' through '~', in order.</p>

<h3>Step 3: Declare Variables</h3>

<p>The following variables are declared:</p>

<pre><code>int shuffleCode[95];
</code></pre>

<p>shuffleCode[95] is an array that will eventually contain "swap positions". In the final step of the Keyshanc function, the keys[] array is shuffled according to the "swap positions" in shuffleCode[].</p>

<pre><code>std::string hexString = "";
</code></pre>

<p>hexString is a string that temporarily holds pairs of hexadecimal characters just prior to their conversion to binary.</p>

<pre><code>std::bitset&lt;8&gt; aByte;
</code></pre>

<p>aByte is the binary representation of hexString.</p>

<pre><code>unsigned long numByte;
</code></pre>

<p>numByte is aByte after it has been converted to an integer.</p>

<h3>Step 4: Compute Swap Positions</h3>

<p>This step is the heart of the Keyshanc algorithm. Each of the 64 bytes of the SHA512 hash and the first 31 bytes of the SHA256 are converted to an integer within the range of 0-94.</p>

<pre><code>//this FOR loop traverses the SHA512 hash string
for (int x=0; x &lt; 64; ++x)
//this FOR loop traverses the SHA256 hash string
for (int x=0; x &lt; 31; ++x)
</code></pre>

<p>Again, Keyshanc uses all 64 bytes from the SHA512 hash but only 31 bytes from the SHA256 hash.</p>

<pre><code>//these two SWITCH statements process the SHA512 hexadecimal pairs
switch (i[x*2])
switch (i[(x*2)+1])
//these two SWITCH statements process the SHA256 hexadecimal pairs
switch (j[x*2])
switch (j[(x*2)+1])
</code></pre>

<p>Since the hash strings i and j are in hexadecimal, the Keyshanc algorithm must process a pair of characters in each iteration of the FOR loops in order to capture an entire byte. The SWITCH statement indexed by [x<em>2] processes the first half of the byte (most significant bits), while the SWITCH statement indexed by [(x</em>2)+1] processes the second half of the byte (least significant bits).</p>

<pre><code>case '0': hexString.append ("0000"); break;
case '1': hexString.append ("0001"); break;
case '2': hexString.append ("0010"); break;
case '3': hexString.append ("0011"); break;
case '4': hexString.append ("0100"); break;
case '5': hexString.append ("0101"); break;
case '6': hexString.append ("0110"); break;
case '7': hexString.append ("0111"); break;
case '8': hexString.append ("1000"); break;
case '9': hexString.append ("1001"); break;
case 'A': hexString.append ("1010"); break;
case 'B': hexString.append ("1011"); break;
case 'C': hexString.append ("1100"); break;
case 'D': hexString.append ("1101"); break;
case 'E': hexString.append ("1110"); break;
case 'F': hexString.append ("1111"); break;
</code></pre>

<p>These case statements convert the hexadecimal characters of the two hash strings into their binary equivalents. These binary patterns are then appended to hexString. Once both SWITCH statements have completed, hexString will contain the binary equivalent of the current hexadecimal pair.</p>

<pre><code>aByte = std::bitset&lt;8&gt;(hexString);
</code></pre>

<p>This line converts hexString into a byte.</p>

<pre><code>numByte = aByte.to_ulong();
</code></pre>

<p>This line converts aByte into an integer.</p>

<pre><code>shuffleCode[x] = numByte%95;
</code></pre>

<p>This line reduces numByte so that it is in the range of 0-94 and stores it in shuffleCode[]. This is necessary because we will use this number as a "swap position" in the final step of the algorithm.</p>

<pre><code>hexString = "";
</code></pre>

<p>This final line of code resets hexString for the next iteration of the FOR loop.</p>

<h3>Step 5: Shuffle the Array</h3>

<p>The final step is to shuffle the array of ASCII characters.</p>

<pre><code>for (int x=0; x &lt; 95; ++x)
</code></pre>

<p>The FOR loop traverses the entire array of ASCII characters.</p>

<pre><code>char temp = keys[x];
keys[x] = keys[shuffleCode[x]];
keys[shuffleCode[x]] = temp;
</code></pre>

<p>This block of code swaps the current ASCII character with the ASCII character located at the position referenced by shuffleCode.</p>

<p>For instance, assume that shuffleCode[0] is 1 and shuffleCode[1] is 2. On the first iteration of the FOR loop keys[0], which is 'Space', will be swapped with keys[1], which is '!'. On the second iteration of the FOR loop keys[1], which is now 'Space', will be swapped with keys[2], which is '"'. So, after the first two iterations of the FOR loop, keys[0] is '!', keys[1] is '"', and keys [2] is 'Space'.</p>

<p>Once the shuffling is complete, keys[] represents a substitution cipher that is used by the calling program to encrypt and decrypt keystrokes. For example, if the user presses the 'Space' key, then the ASCII character located at keys[0] is transmitted. Likewise, if the user types '~', then keys[94] is transmitted. The receiving application performs a reverse lookup to determine the plaintext character.</p>

</div>


  <div class="footer">
    <div class="contact">
      <p>
      Â© 2012 Andrew C. Reed. Theme and code from <a href="https://github.com/mojombo">Tom Preston-Werner</a>.<br />
      Hosted by <a href="https://github.com/networc/networc.github.com/">GitHub</a> and powered by <a href="https://github.com/mojombo/jekyll">Jekyll</a>.
      </p>
    </div>
    <div class="rss">
      <p>
        <div class="social">
          <div class="g-plusone" data-size="medium" data-annotation="none" data-href="http://andrewcreed.com"></div>
        </div>
        <div class="social">
          <a href="https://twitter.com/ac_reed" class="twitter-follow-button" data-show-count="false" data-show-screen-name="false">Follow</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
        </div>
        <a href="http://feeds.feedburner.com/andrewcreed">
           <img src="/images/feed.png" width ="21" height="21" alt="Subscribe to RSS Feed" />
        </a>
      </p>
    </div>
  </div>
</div>

<!-- GitHub Fork Me Ribbon -->
<a href="http://github.com/networc/"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://a248.e.akamai.net/assets.github.com/img/7afbc8b248c68eb468279e8c17986ad46549fb71/687474703a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f6461726b626c75655f3132313632312e706e67" alt="Fork me on GitHub"></a>

<!-- Google+ Plus One Button, asynchronous code -->
<script type="text/javascript">
  (function() {
    var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
    po.src = 'https://apis.google.com/js/plusone.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
  })();
</script>
<!-- End Google+ Plus One Button code -->

</body>
</html>
